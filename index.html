<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash of Clans Vault - Frost Age Season</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Electrolize&family=Exo+2:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="global.css">
    <style>
        /* --- CONTENT SECTIONS --- */
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
        }

        .section-title i {
            color: var(--accent-blue);
            margin-right: 10px;
        }

        /* --- CURRENT SEASON SKINS --- */
        .skins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .skin-card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .skin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-blue);
        }

        .skin-image {
            width: 100%;
            height: 250px;
            background-color: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 1rem;
            background-size: cover;
            background-position: center;
        }

        .skin-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .view-3d-btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: var(--accent-blue);
            color: #000;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .view-3d-btn:hover {
            background-color: #008ac9;
        }

        /* --- SCENERIES & DECORATIONS --- */
        .content-row {
            display: flex;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .content-box {
            flex: 1;
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .content-box h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .content-box h3 i {
            color: var(--accent-gold);
            margin-right: 8px;
        }

        .preview-image {
            width: 100%;
            height: 200px;
            background-color: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 1rem;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* --- DECORATIONS & OBSTACLES GRID --- */
        .decorations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .decoration-card {
            background-color: var(--bg-card);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .decoration-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-gold);
        }

        .decoration-image {
            width: 100%;
            height: 80px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .decoration-name {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.2;
        }

        /* --- CALENDAR & EVENTS --- */
        .events-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .calendar-box {
            background-color: var(--bg-panel);
            border-radius: 8px;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            max-width: 100%;
            font-size: 0.45rem;
            /* Scale down text base */
        }

        /* Calendar Header */
        .calendar-header {
            text-align: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-month {
            font-size: 0.55rem;
            font-weight: 700;
            color: var(--accent-gold);
        }

        /* Removed calendar navigation - seasonal calendar only */
        .calendar-nav {
            display: none;
        }

        /* ... existing button styles ... */

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            color: var(--accent-gold);
            padding: 0.1rem;
            font-size: 0.35rem;
        }

        .calendar-day {
            /* aspect-ratio: 1; Removed to allow height to grow */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            /* Align to top */
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            padding: 2px 1px;
            /* Slight padding for content */
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 28px;
            height: auto;
            /* Allow growth */
            font-size: 0.5em;
        }

        .calendar-day:hover {
            background-color: rgba(0, 168, 255, 0.1);
            border-color: var(--accent-blue);
            transform: scale(1.05);
        }

        .calendar-day.empty {
            background-color: transparent;
            border: none;
            cursor: default;
        }

        .calendar-day.empty:hover {
            transform: none;
        }

        .calendar-day.today {
            border: 2px solid var(--accent-blue);
            box-shadow: 0 0 10px rgba(0, 168, 255, 0.3);
        }

        .calendar-day.has-event {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.15), rgba(0, 168, 255, 0.15));
            border-color: var(--accent-gold);
        }

        .day-number {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.2rem;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
            width: 100%;
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .day-event-marker {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            /* Align left for icon + text */
            gap: 2px;
            padding: 1px 2px;
            border-radius: 2px;
            background-color: rgba(0, 168, 255, 0.2);
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            font-size: 11px;
            /* Bigger for desktop */
            line-height: 1.1;
            margin: 1px 0;
            height: auto;
        }

        .event-marker-icon {
            height: 10px;
            width: auto;
            display: block;
        }

        .day-event-marker i {
            font-size: 10px;
        }

        .day-event-marker.event-start {
            background-color: rgba(0, 255, 100, 0.2);
            color: #00ff64;
        }

        .day-event-marker.event-end {
            background-color: rgba(255, 100, 0, 0.2);
            color: #ff6400;
        }

        .day-event-marker.event-instant {
            background-color: rgba(255, 204, 0, 0.2);
            color: var(--accent-gold);
        }

        /* Active Events */
        .active-events-box {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .event-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-item:hover {
            background-color: rgba(0, 168, 255, 0.1);
            transform: translateX(5px);
        }

        /* --- EVENTS SIDEBAR (Active & Upcoming) --- */
        .events-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            padding-top: 2rem;
        }

        .active-events-box,
        .upcoming-events-box {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .active-events-box h2,
        .upcoming-events-box h2 {
            font-size: 1.5rem;
            /* Match section title size if needed, or keep default */
        }

        .upcoming-event-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            transition: all 0.2s;
            opacity: 0.8;
            /* Slightly dimmed for upcoming */
        }

        .upcoming-event-item:hover {
            opacity: 1;
            background-color: rgba(0, 255, 100, 0.1);
            /* Greenish tint for upcoming */
            transform: translateX(5px);
        }

        .upcoming-event-item:last-child {
            border-bottom: none;
        }

        .event-icon {
            font-size: 1.5rem;
            color: var(--accent-gold);
            margin-right: 1rem;
            min-width: 40px;
            max-width: 40px;
            height: 40px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .event-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .event-details h4 {
            font-size: 1rem;
            margin-bottom: 0.2rem;
        }

        .event-details p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .no-events {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-style: italic;
        }

        /* --- TRADER REFRESH NOTIFICATION --- */
        .trader-notification {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(0, 168, 255, 0.1));
            border: 2px solid var(--accent-gold);
            border-radius: 8px;
            padding: 0.8rem 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            animation: pulse 2s ease-in-out infinite;
        }

        .trader-notification.hidden {
            display: none;
        }

        .trader-notification .trader-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .trader-notification-text {
            flex: 1;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .trader-notification-text .trader-time {
            color: var(--accent-gold);
            font-weight: bold;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.4);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(255, 204, 0, 0);
            }
        }

        @media (max-width: 480px) {
            .trader-notification {
                padding: 0.6rem 0.8rem;
                font-size: 0.85rem;
            }

            .trader-notification .trader-icon {
                width: 24px;
                height: 24px;
            }
        }

        /* --- EXTRA FEATURES --- */
        .extras-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .extra-feature-card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.2s;
        }

        .extra-feature-card:hover {
            transform: translateY(-5px);
        }

        .extra-icon {
            font-size: 2.5rem;
            color: var(--accent-blue);
            margin-bottom: 1rem;
        }

        /* --- RESPONSIVE --- */
        /* Navbar responsive styles are in global.css */

        @media (max-width: 768px) {
            .season-timer-container {
                flex-wrap: wrap;
                justify-content: center;
            }

            .content-row,
            .events-container {
                grid-template-columns: 1fr;
                flex-direction: column;
            }

            .calendar-day {
                min-height: 50px;
                font-size: 0.8rem;
            }
        }

        /* Ultra-Small Mobile (315px - 360px) */
        @media (max-width: 360px) {
            .logo-image {
                height: 50px;
                margin: -5px 0;
            }

            .season-title {
                font-size: 1.3rem;
            }

            .timer-value {
                font-size: 1.3rem;
            }

            .calendar-day {
                min-height: 24px;
                font-size: 0.25rem;
                padding: 0;
            }

            .calendar-box {
                padding: 1rem 0.5rem;
                max-width: 400px;
            }

            .calendar-month {
                font-size: 1rem;
            }

            .calendar-grid {
                gap: 0.15rem;
            }

            .calendar-day-header {
                font-size: 0.65rem;
                padding: 0.2rem;
            }

            .day-number {
                font-size: 0.7rem;
            }

            .day-event-marker {
                font-size: 10px;
                /* 10px small for mobile */
                padding: 0px 1px;
            }

            .skins-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.8rem;
            }

            .skin-image {
                height: 160px;
            }

            .decorations-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 0.4rem;
            }

            .decoration-image {
                height: 55px;
            }

            .decoration-name {
                font-size: 0.6rem;
            }
        }


        /* Small Mobile (320px - 480px) */
        @media (max-width: 480px) {
            .logo-image {
                height: 60px;
                margin: -5px 0;
            }

            .season-title {
                font-size: 1.5rem;
            }

            .timer-value {
                font-size: 1.5rem;
            }

            .calendar-grid {
                gap: 0.15rem;
            }

            .calendar-day {
                min-height: 28px;
                font-size: 0.3rem;
                padding: 0;
            }

            .calendar-day-header {
                font-size: 0.7rem;
                padding: 0.15rem;
            }

            .day-event-marker {
                font-size: 10px;
                /* 10px small for mobile */
                line-height: 1;
                justify-content: center;
                /* Center the icon */
                padding: 1px;
            }

            .event-text {
                display: none;
                /* Hide text on mobile */
            }

            .skins-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 1rem;
            }

            .skin-image {
                height: 180px;
            }

            .event-icon {
                min-width: 30px;
                max-width: 30px;
                height: 30px;
            }

            .decorations-grid {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
                gap: 0.5rem;
            }

            .decoration-image {
                height: 60px;
            }

            .decoration-name {
                font-size: 0.65rem;
            }
        }

        /* Tablet Portrait (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .events-container {
                grid-template-columns: 1.5fr 1fr;
            }

            .skins-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }

            .calendar-day {
                min-height: 32px;
            }
        }

        /* Large Desktop (1441px+) */
        @media (min-width: 1441px) {
            .main-content {
                max-width: 1400px;
            }

            .skins-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }

            /* Scale up Calendar for Big Screens */
            .calendar-day {
                min-height: 48px;
                /* Taller cells */
                font-size: 0.9rem;
                /* Bigger day numbers */
            }

            .calendar-day-header {
                font-size: 0.8rem;
                /* Bigger headers */
                padding: 0.4rem;
            }

            .calendar-month {
                font-size: 1.2rem;
                /* Bigger month title */
            }

            .day-event-marker {
                font-size: 13px;
                /* Readable event text */
                padding: 2px 4px;
                gap: 4px;
            }

            .event-marker-icon {
                height: 14px;
                /* Larger icons */
            }

            .day-event-marker i {
                font-size: 14px;
            }

            .events-container {
                grid-template-columns: 2.5fr 1fr;
            }
        }

        /* Calendar Image */
        .calendar-image-container {
            width: 100%;
            height: auto;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--bg-card);
        }

        .calendar-image {
            width: 100%;
            height: auto;
            display: block;
            object-fit: contain;
        }

        @media (max-width: 768px) {
            .calendar-image-container {
                min-height: 200px;
            }
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <div class="logo-container">
            <img src="clashicons/logomain.png" alt="Clash of Clans Vault" class="logo-image">
        </div>
        <div class="nav-links">
            <a href="index.html" class="active">Home</a>
            <a href="tracker/index.html">Tracker</a>
            <a href="wiki/index.html">Wiki</a>
            <a href="privacy.html">Privacy Policy</a>
        </div>
    </nav>

    <main class="main-content">

        <section class="events-container">
            <div class="calendar-box">
                <h2 class="section-title">Season Calendar</h2>
                <div class="calendar-image-container">
                    <img id="calendarImage" src="" alt="Season Calendar" class="calendar-image">
                </div>
            </div>

            <div class="events-sidebar">
                <div class="active-events-box">
                    <!-- Trader Refresh Notification -->
                    <div id="traderNotification" class="trader-notification hidden">
                        <img src="clashicons/Villager_HV_Trader_2.png" alt="Trader" class="trader-icon">
                        <div class="trader-notification-text">
                            The trader refreshes in <span class="trader-time" id="traderTime">--</span>
                        </div>
                    </div>

                    <h2 class="section-title">Active Events</h2>
                    <div id="activeEventsContainer">
                        <!-- Active events will be rendered here -->
                    </div>
                </div>

                <div class="upcoming-events-box">
                    <h2 class="section-title">Upcoming Events</h2>
                    <div id="upcomingEventsContainer">
                        <!-- Upcoming events will be rendered here -->
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2 class="section-title">Current Season Hero Skins</h2>
            <div class="skins-grid" id="skinsGrid">
                <!-- Skins will be dynamically rendered here -->
            </div>
        </section>

        <section class="content-row">
            <div class="content-box">
                <h3>This Season's Scenery</h3>
                <div class="preview-image" id="sceneryImage"></div>
                <h4 id="sceneryName" style="margin-bottom: 0.5rem;">Loading...</h4>
                <p style="color: var(--text-muted);">Transform your village into a frozen tundra.
                </p>
            </div>
            <div class="content-box">
                <h3>Season Decorations & Obstacles</h3>
                <div id="decorationsContainer">
                    <!-- Decorations and obstacles will be rendered here -->
                </div>
            </div>
        </section>

        <section>
            <h2 class="section-title">Extra Features</h2>
            <div class="extras-grid">
                <div class="extra-feature-card">
                    <i class="fas fa-chart-line extra-icon"></i>
                    <h3>Progress Tracker</h3>
                    <p style="color: var(--text-muted);">Track your upgrade progress and achievements.</p>
                </div>
                <div class="extra-feature-card">
                    <i class="fas fa-book extra-icon"></i>
                    <h3>Strategy Wiki</h3>
                    <p style="color: var(--text-muted);">In-depth guides and attack strategies.</p>
                </div>
                <div class="extra-feature-card">
                    <i class="fas fa-palette extra-icon"></i>
                    <h3>Asset Browser</h3>
                    <p style="color: var(--text-muted);">Browse all game assets, sounds, and models.</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="footer">
        <div class="logo-container" style="justify-content: center; margin-bottom: 1rem;">
            <img src="clashicons/logomain.png" alt="Clash of Clans Vault" class="logo-image"
                style="height: 100px; margin: -20px 0;">
        </div>
        <div class="footer-links">
            <a href="index.html">Home</a>
            <a href="tracker/index.html">Tracker</a>
            <a href="wiki/index.html">Wiki</a>
            <a href="privacy.html">Privacy Policy</a>
            <a href="mailto:clashofclanscollections@gmail.com">Contact</a>
        </div>
        <p style="margin-top: 1rem; font-size: 0.8rem;">This content is not affiliated with, endorsed, sponsored, or
            specifically approved by Supercell and Supercell is not responsible for it.</p>
    </footer>

    <!-- Load Events Manager -->
    <script src="events-manager.js"></script>

    <script>
        // ========================================================================
        // SEASON DATA & CALENDAR MANAGER
        // ========================================================================

        let seasonData = null;
        let currentDisplayMonth = new Date();

        // ========================================================================
        // INITIALIZATION
        // ========================================================================
        async function init() {
            try {
                // Load season data
                await loadSeasonData();

                // Load events configuration
                await eventsManager.loadEvents('events-config.json');

                // Render all sections
                renderSkins();
                renderScenery();
                renderDecorations();
                renderCalendarImage();
                renderTraderNotification();
                renderActiveEvents();
                renderUpcomingEvents();

                // Update active events and trader notification every second
                setInterval(() => {
                    renderActiveEvents();
                    renderTraderNotification();
                }, 1000);

                console.log('Page initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        // ========================================================================
        // LOAD SEASON DATA
        // ========================================================================
        async function loadSeasonData() {
            try {
                const response = await fetch('season-data.json');
                if (!response.ok) throw new Error('Failed to load season data');
                seasonData = await response.json();
            } catch (error) {
                console.error('Error loading season data:', error);
                throw error;
            }
        }



        // ========================================================================
        // CALENDAR RENDERING
        // ========================================================================
        function renderCalendarImage() {
            const calendarImage = document.getElementById('calendarImage');
            if (seasonData.calendar_image) {
                calendarImage.src = seasonData.calendar_image;
            } else {
                calendarImage.alt = "No calendar available";
            }
        }

        // Calendar locked to current month (current season only)
        // No navigation needed

        // ========================================================================
        // ACTIVE EVENTS
        // ========================================================================
        function renderActiveEvents() {
            const container = document.getElementById('activeEventsContainer');
            const activeEvents = eventsManager.getActiveEvents();

            if (activeEvents.length === 0) {
                container.innerHTML = '<div class="no-events">No active events right now</div>';
                return;
            }

            container.innerHTML = '';
            activeEvents.forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';

                // Determine icon/image to use
                let iconHtml;
                if (event.image) {
                    iconHtml = `<div class="event-icon"><img src="${event.image}" alt="${event.title}"></div>`;
                } else {
                    iconHtml = `<i class="fas fa-${event.icon} event-icon"></i>`;
                }

                eventItem.innerHTML = `
                    ${iconHtml}
                    <div class="event-details">
                        <h4>${event.title}</h4>
                        <p>Ends in ${event.countdownText}</p>
                    </div>
                `;
                container.appendChild(eventItem);
            });
        }

        // ========================================================================
        // HERO SKINS
        // ========================================================================
        function renderSkins() {
            const skinsGrid = document.getElementById('skinsGrid');
            skinsGrid.innerHTML = '';

            seasonData.skins.forEach(skin => {
                const skinCard = document.createElement('div');
                skinCard.className = 'skin-card';
                skinCard.innerHTML = `
                    <div class="skin-image" style="background-image: url('${skin.image}');"></div>
                    <h3 class="skin-name">${skin.name}</h3>
                `;
                skinsGrid.appendChild(skinCard);
            });
        }

        // ========================================================================
        // SCENERY
        // ========================================================================
        function renderScenery() {
            const sceneryImage = document.getElementById('sceneryImage');
            const sceneryName = document.getElementById('sceneryName');

            sceneryImage.style.backgroundImage = `url('${seasonData.scenery.image}')`;
            sceneryName.textContent = seasonData.scenery.name;
        }

        // ========================================================================
        // DECORATIONS & OBSTACLES
        // ========================================================================
        function renderDecorations() {
            const container = document.getElementById('decorationsContainer');
            container.innerHTML = '';

            // Create a grid container
            const gridDiv = document.createElement('div');
            gridDiv.className = 'decorations-grid';

            seasonData.decorations.forEach(item => {
                const decorationCard = document.createElement('div');
                decorationCard.className = 'decoration-card';
                decorationCard.innerHTML = `
                    <div class="decoration-image" style="background-image: url('${item.image}');"></div>
                    <div class="decoration-name">${item.name}</div>
                `;
                gridDiv.appendChild(decorationCard);
            });

            container.appendChild(gridDiv);
        }

        // ========================================================================
        // TRADER REFRESH NOTIFICATION
        // ========================================================================
        function renderTraderNotification() {
            const notification = document.getElementById('traderNotification');
            const timeElement = document.getElementById('traderTime');

            if (!notification || !timeElement) return;

            // Get upcoming events to find Trader Refresh
            const upcomingEvents = eventsManager.getUpcomingEvents(new Date(), 30);
            const traderEvent = upcomingEvents.find(event => event.title === 'Trader Refresh');

            if (traderEvent) {
                const now = new Date();
                const diffMs = traderEvent.start.getTime() - now.getTime();

                if (diffMs > 0) {
                    const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));

                    let timeString = '';
                    if (days > 0) {
                        timeString = `${days}d ${hours}h ${minutes}m`;
                    } else if (hours > 0) {
                        timeString = `${hours}h ${minutes}m`;
                    } else {
                        timeString = `${minutes}m`;
                    }

                    timeElement.textContent = timeString;
                    notification.classList.remove('hidden');
                } else {
                    // Trader has already refreshed, hide notification
                    notification.classList.add('hidden');
                }
            } else {
                // No trader event found, hide notification
                notification.classList.add('hidden');
            }
        }

        // ========================================================================
        // UPCOMING EVENTS
        // ========================================================================
        function renderUpcomingEvents() {
            const container = document.getElementById('upcomingEventsContainer');
            if (!container) return; // Guard clause in case element is missing

            // Get upcoming events for next 30 days
            const upcomingEvents = eventsManager.getUpcomingEvents(new Date(), 30);

            if (upcomingEvents.length === 0) {
                container.innerHTML = '<div class="no-events">No upcoming events in next 30 days</div>';
                return;
            }

            container.innerHTML = '';

            // Filter out Trader Refresh as it's shown in the notification banner
            // Also filter out events that are currently active (already shown in Active Events)
            const filteredEvents = upcomingEvents.filter(event => {
                return event.title !== 'Trader Refresh' && !event.isActive;
            });

            if (filteredEvents.length === 0) {
                container.innerHTML = '<div class="no-events">No upcoming events in next 30 days</div>';
                return;
            }

            filteredEvents.forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = 'upcoming-event-item';

                // Determine icon/image to use
                let iconHtml;
                if (event.image) {
                    iconHtml = `<div class="event-icon"><img src="${event.image}" alt="${event.title}"></div>`;
                } else {
                    iconHtml = `<i class="fas fa-${event.icon} event-icon"></i>`;
                }

                // Calculate format for "Starts in..."
                const now = new Date();
                const diffMs = event.start.getTime() - now.getTime();
                const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

                let timeString = "";
                if (days > 0) timeString = `${days}d ${hours}h`;
                else timeString = `${hours}h`;

                eventItem.innerHTML = `
                    ${iconHtml}
                    <div class="event-details">
                        <h4>${event.title}</h4>
                        <p style="color: var(--accent-gold); font-size: 0.8rem;">Starts in ${timeString}</p>
                        <p style="font-size: 0.7rem; color: var(--text-muted);">${event.start.toLocaleDateString()}</p>
                    </div>
                `;
                container.appendChild(eventItem);
            });
        }

        // Initialize when DOM is loaded
        window.addEventListener('DOMContentLoaded', init);
    </script>

</body>

</html>